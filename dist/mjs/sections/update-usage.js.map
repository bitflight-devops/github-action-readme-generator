{"version":3,"file":"update-usage.js","sourceRoot":"","sources":["../../../src/sections/update-usage.ts"],"names":[],"mappings":"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","sourcesContent":["import { getCurrentVersionString } from '../helpers.js';\nimport type Inputs from '../inputs.js';\nimport LogTask from '../logtask/index.js';\nimport { wrapDescription } from '../prettier.js';\nimport type { ReadmeSection } from './index.js';\n\ntype DescriptionType = Record<string, string[]>;\nexport default async function updateUsage(token: ReadmeSection, inputs: Inputs): Promise<void> {\n  const log = new LogTask(token);\n  log.start();\n  const actionName = `${inputs.config.get('owner') as string}/${inputs.config.get('repo')}`;\n  log.info(`Action name: ${actionName}`);\n  const versionString: string = getCurrentVersionString(inputs);\n\n  log.info(`Version string: ${versionString}`);\n\n  const actionReference = `${actionName}@${versionString}`;\n\n  if (!actionReference) {\n    throw new Error('Parameter actionReference must not be empty');\n  }\n\n  // Build the new README\n  const content: string[] = [];\n  // Build the new usage section\n  content.push('```yaml', `- uses: ${actionReference}`, '  with:');\n\n  const inp = inputs.action.inputs;\n  let firstInput = true;\n  const descriptionPromises: Record<string, Promise<string[]>> = {};\n  for (const key of Object.keys(inp)) {\n    const input = inp[key];\n    if (input !== undefined) {\n      descriptionPromises[key] = wrapDescription(`Description: ${input.description}`, [], '    # ');\n    }\n  }\n  const descriptions: DescriptionType = {};\n  const kvArray = await Promise.all(\n    Object.keys(descriptionPromises).map(async (key) => {\n      return { key, value: await descriptionPromises[key] };\n    }),\n  );\n  for (const e of kvArray) {\n    descriptions[e.key] = e.value;\n    log.info(`${e.key}: ${descriptions[e.key].join('\\n')}`);\n  }\n\n  if (inp) {\n    for (const key of Object.keys(inp)) {\n      const input = inp[key];\n      if (input !== undefined) {\n        // Line break between inputs\n        if (!firstInput) {\n          content.push('');\n        }\n\n        // Constrain the width of the description, and append it\n        content.push(...descriptions[key]);\n\n        if (input.default !== undefined) {\n          // Append blank line if description had paragraphs\n          // if (input.description?.trimEnd().match(/\\n *\\r?\\n/)) {\n          //   content.push('    #');\n          // }\n\n          // Default\n          content.push(`    # Default: ${input.default}`);\n        }\n\n        // Input name\n        content.push(`    ${key}: ''`);\n\n        firstInput = false;\n      }\n    }\n  }\n\n  content.push('```\\n');\n\n  inputs.readmeEditor.updateSection(token, content);\n  log.success();\n}\n"]}